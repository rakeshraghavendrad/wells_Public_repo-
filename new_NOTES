# Compute mean and standard deviation
stats = nsc.select(
    mean(col("frequency_count")).alias("mean"),
    stddev(col("frequency_count")).alias("stddev")
).collect()[0]

mu = stats["mean"]
sigma = stats["stddev"]

# Define Z-score threshold (e.g., Z > -1.5 to filter low outliers)
z_threshold = -1.5

# Compute Z-score and filter outliers
nsc_filtered_zscore = nsc.withColumn(
    "z_score", (col("frequency_count") - lit(mu)) / lit(sigma)
).filter(col("z_score") >= z_threshold).drop("z_score")

# Show results
print(f"Mean: {mu}, Standard Deviation: {sigma}, Z-Score Cutoff: {z_threshold}")
nsc_filtered_zscore.show()
