from PIL import Image, ImageEnhance, ImageDraw
import numpy as np
import matplotlib.pyplot as plt
import os

def create_plain_card(img, coordinates):
    """ Create a plain card by removing text and headshot regions """
    draw = ImageDraw.Draw(img)
    for coord in coordinates:
        xmin, ymin, xmax, ymax = coord
        # Get the background color from the top-left corner of the region
        background_color = img.getpixel((xmin, ymin))
        # Replace the text region with the background color
        draw.rectangle([xmin, ymin, xmax, ymax], fill=background_color)
    return img

def move_object(df, direction_list, percent_list):
    for index, row in df.iterrows():
        image_path = os.path.join(DIR, row['FILE_NAME'])
        print(f"FILE NAME: {image_path}")
        
        # Load the image
        img = Image.open(image_path)
        print(f"Image size: {img.size}")

        # Create a plain card without text and headshot
        coordinates = []
        for element in columns:
            print(f"Operations performed on: {element}")
            xmin, ymin, xmax, ymax = map(int, row[element].split(','))
            coordinates.append((xmin, ymin, xmax, ymax))

        plain_card = create_plain_card(img.copy(), coordinates)

        for element in columns:
            print(f"Operations performed on: {element}")
            
            # Extract coordinates
            xmin, ymin, xmax, ymax = map(int, row[element].split(','))
            cropped_img = img.crop((xmin, ymin, xmax, ymax))

            for direction in direction_list:
                print(f"The direction is: {direction}")
                for percent in percent_list:
                    print(f"The percent is: {percent}")
                    
                    # Determine new coordinates based on direction
                    new_x, new_y = xmin, ymin
                    if direction == 'up':
                        new_y = max(0, ymin - int(img.height * percent / 100))
                    elif direction == 'down':
                        new_y = min(img.height - (ymax - ymin), ymin + int(img.height * percent / 100))
                    elif direction == 'left':
                        new_x = max(0, xmin - int(img.width * percent / 100))
                    elif direction == 'right':
                        new_x = min(img.width - (xmax - xmin), xmin + int(img.width * percent / 100))

                    # Create a new image with the plain card and moved text
                    mod_img = plain_card.copy()
                    mod_img.paste(cropped_img, (new_x, new_y))

                    # Display the final image
                    plt.figure(figsize=(10, 8))
                    plt.imshow(mod_img)
                    plt.title(f"Image with moved text: {element}")
                    plt.show()
                    
                    print(f"Image with moved text: {element}")

# Example usage
direction_list = ['left']
percent_list = [10]
move_object(df, direction_list, percent_list)
