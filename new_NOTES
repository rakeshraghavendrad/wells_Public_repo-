from PIL import Image, ImageDraw, ImageEnhance
import numpy as np
import matplotlib.pyplot as plt
import os

def move_object(df, direction_list, percent_list, dir_path):
    for index, row in df.iterrows():
        image_path = os.path.join(dir_path, row['FILE_NAME'])
        print(f"FILE NAME: {image_path}")

        # Load the image
        img = Image.open(image_path)
        print(f"Original image size: {img.size}")

        for element in row.index:
            if pd.isna(row[element]):
                continue

            print(f"Operations performed on: {element}")
            
            # Extract coordinates
            xmin, ymin, xmax, ymax = map(int, row[element].split(','))

            # Extract the cropped image
            cropped_img = img.crop((xmin, ymin, xmax, ymax))
            background_color = cropped_img.getpixel((0, 0))

            # Create a new image with the same background
            img_copy = img.copy()
            draw = ImageDraw.Draw(img_copy)

            # Fill the original text area with the background color
            draw.rectangle((xmin, ymin, xmax, ymax), fill=background_color)

            # Move the text based on direction and percentage
            for direction in direction_list:
                for percent in percent_list:
                    print(f"Direction: {direction}, Percent: {percent}")

                    dx = int(img.width * percent / 100)
                    dy = int(img.height * percent / 100)

                    if direction == 'up':
                        new_y = max(0, ymin - dy)
                        img_copy.paste(cropped_img, (xmin, new_y))
                    elif direction == 'down':
                        new_y = min(img.height - (ymax - ymin), ymin + dy)
                        img_copy.paste(cropped_img, (xmin, new_y))
                    elif direction == 'left':
                        new_x = max(0, xmin - dx)
                        img_copy.paste(cropped_img, (new_x, ymin))
                    elif direction == 'right':
                        new_x = min(img.width - (xmax - xmin), xmin + dx)
                        img_copy.paste(cropped_img, (new_x, ymin))

            # Plotting the modified image for verification
            plt.figure(figsize=(10, 8))
            plt.imshow(img_copy)
            plt.title(f"Moved Text - Direction: {direction}, Percent: {percent}")
            plt.axis('off')
            plt.show()

# Example usage
direction_list = ['right']
percent_list = [5]
# Assuming the DataFrame 'df_new' and directory 'DIR' are provided
# move_object(df_new, direction_list, percent_list, DIR)
