import pandas as pd
from pyspark.sql import SparkSession
from pyspark.sql.functions import udf
import base64
from pyspark.sql.types import StringType

# Step 1: Read the Excel file
excel_df = pd.read_excel('your_file.xlsx')

# Step 2: Convert Pandas DataFrame to Spark DataFrame
spark = SparkSession.builder.appName("Base64Decode").getOrCreate()
spark_df = spark.createDataFrame(excel_df)

# Step 3: Decode Base64 Encoded Data
def decode_base64(encoded_str):
    try:
        return base64.b64decode(encoded_str).decode('utf-8')
    except Exception as e:
        return None

decode_base64_udf = udf(decode_base64, StringType())

# Replace 'base64_column' with your actual column name
decoded_df = spark_df.withColumn('decoded_column', decode_base64_udf(spark_df['base64_column']))

# Step 4: Display the Decoded Data
decoded_df.show(truncate=False)
